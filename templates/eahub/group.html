{% extends 'base.html' %}

{% block content %}
<head>
  <link rel="stylesheet" type="text/css"  href="/static/styles/profile.css">
</head>

<div class="container-narrow profile">
  
  <div class="profile-head">
    <img src="{% firstof group.pic '/static/images/group_avatar.png' %}" class="profile-pic"/>
    <h1 class="profile-name">{{ group.name|title }}</h1>
    <div class="profile-contact">
    {% if user in group.organisers.all %}
      <a href="{% url 'edit_group' group_id=group.id %}"><i class="fa fa-pencil"></i> Edit</a>
    {% elif group.official_email %}
      <a href="mailto:{{ group.official_email }}">Connect</a>
    {% elif group.facebook_group %}
      <a href="group.facebook_group }}">Connect</a>
    {% elif group.facebook_page %}
      <a href="group.facebook_page }}">Connect</a>
    {% elif group.lean_email %}
      <a href="mailto:{{ group.lean_email }}">Connect</a>
    {% endif %}
    </div>
  </div>

  <div class="row">
    {% if group.lat and group.lon %}
    <div class="profile-key-facts col-sm-6">
    {% else %}
    <div class="profile-key-facts col-sm-6 col-sm-offset-3">
    {% endif %}
      <h3>Key facts</h3>
      <ul>
        {% if group.facebook_group %}
          <li><a href="{{ group.facebook_group }}"><i class="fa fa-facebook"></i> Community</a></li>
        {% endif %}
        {% if group.website %}
          <li><b><a href="{{ group.website }}">Website</a></b></li>
        {% endif %}
        {% if group.country %}
          <li><b>Country:</b> {{ group.country }}</li>
        {% endif %}
        {% if group.organisers %}
            <div class="group-key-facts-sublist">
            <li>
              {% if group.organisers.all|length > 1 %}
              <b>Organisers:</b>
              <ul>
                {% for organiser in group.organisers.all %}
                  <li>{{ organiser }}</li>
                {% endfor %}
              </ul>
              {% elif group.organisers.all|length == 1 %}
              <b>Organiser:</b>
                {% for organiser in group.organisers.all %}
                  {{ organiser }}
                {% endfor %}
              {% endif %}
            </li>
            </div>
        {% endif %}
      </ul>
    </div>

    {% if group.lat and group.lon %}
    <div class="col-sm-6 profile-map">
      <a href="/groups">
      {% include 'eahub/maps/profile_link.html' with lat=group.lat lon=group.lon %}
      </a>
    </div>
    {% endif %}
  </div>

  {% if group.summary %}
  <div class="profile-info">
    <h3>Summary</h3>
    <p>
      {{ group.summary }}
    </p>
  </div>
  {% endif %}

  {% if group.donations  %}
  <div class="profile-info">
    <h3>Donations</h3>
    <table class="table table-striped table-bordered table-donations">
      <thead>
        <tr>
            <th>To</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Details</th>
        </tr>
      </thead>
      <tbody  id="table_donations">
      </tbody>
    </table>
  </div>
  {% endif %}

  {% if group.custom  %}
  <div class="profile-info">
    <h3>Custom</h3>
    <p>
      {{ group.custom }}
    </p>
  </div>
  {% else %}
  <div class="profile-info">
    <h3>Custom</h3>
    <p>
      This is a dummy text to show what the custom field would look like.
    </p>
  </div>
  {% endif %}

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
  var donations = {{ group.donations | safe }}
  // var organisers = {{ group.organisers.all | safe }}
  // console.log(organisers);
  donations = donations.donations
  var table_donations = $("#table_donations")
  donations.forEach(function(donation) {
    var tr = $('<tr>')
    tr.append('<td>' + donation.to + '</td>')
    tr.append('<td>' + donation.amount + '</td>')
    tr.append('<td>' + donation.when + '</td>')
    tr.append('<td>' + donation.details + '</td>')
    table_donations.append(tr)
  })
</script>

{% endblock %}
